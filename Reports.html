<!DOCTYPE html>
<html>
<head>
    <title>Reports</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="styles/bootstrap.css" rel="stylesheet" />
    <link href="styles/common.css" rel="stylesheet" />
    <link type="text/css" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/free-jqgrid/4.15.2/css/ui.jqgrid.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.8.9/jquery.csv.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqgrid/4.6.0/js/i18n/grid.locale-en.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/free-jqgrid/4.15.2/jquery.jqgrid.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js" type="text/javascript"></script>

    <link rel="icon" type="image/png" href="https://cdn.vox-cdn.com/thumbor/GWgXis1BkY5kka5WbUIMeqbnoGA=/0x64:512x448/1200x900/filters:focal(0x64:512x448)/cdn.vox-cdn.com/uploads/chorus_image/image/47935485/original.0.png" />

    <style type="text/css">
        #gbox_jqGrid {
            top: 66px !important;
            margin-left: 15px;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Verdana,Arial,Helvetica,sans-serif;
            font-size: 14px;
            font-weight: normal;
        }

        table {
            top: 0px;
            /*position: relative;*/
        }
        th {
            height: 18px;
            vertical-align: middle;
            position: sticky;
            top: 50px;
            border: solid 1px #000000;
        }
        td {
            height: 10px;
            vertical-align: middle;
        }
        .active {
            color: #8fd550 !important;
        }
    </style>
</head>
<body>

    <!--################## HEADER #########################-->
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"></button>
                <a class="navbar-brand" runat="server" href="RoadProfile.html">Alten Lean Framework</a>
            </div>
            <div class="navbar-collapse collapse" id="sub-header">
                <ul class="nav navbar-nav">

                    <li><a runat="server" href="RoadProfile.html">Rough Roads Profile</a></li>
                    <li><a runat="server" href="potHoleProfile.html">Pot Holes Profile</a></li>
                    <li><a runat="server" href="Reports.html" class="active">Reports</a></li>
                    <li><a runat="server" href="Analysis.html">Analysis</a></li>
                    <li><a runat="server" href="rawData.html">RawData</a></li>

                </ul>

            </div>
        </div>
    </div>

    <!--################## BODY #########################-->
    <label style="padding-left: 20px; padding-top: 55px;"> PotHole Report</label>
    <div id="reportDiv" style="align-content: left; position: absolute; padding-left: 20px; padding-top: 10px;">

    </div>
    <!--################## FOOTER #########################-->
    <footer>
        <p>
            &copy;
            <script type="text/javascript">
                document.write(new Date().getFullYear());
            </script> - All Rights Reserved
        </p>
    </footer>

    <!--############# jqGrid SCRIPTS #################-->
    <script>
        var reportdataArray = [];
        var reportDataLengthCounter = 0;
        var potholesLimit = 1.15;
        var minRoughRoad = 0.5;
        var maxRoughRoad = 0.9;

        function checkCriteriaData(responseData) {

            filterOutReportData(responseData);
            console.log("report data" + reportdataArray);
            myFunction();
        }




        //to filter out the report data
        function filterOutReportData(responseData) {

            storeReportData('Latitude', 'Longitude', 'Severity', 'Since', reportdataArray);

            for (var i = 0; i < responseData.data.length; i++) {
               
                    reportDataLengthCounter++;
                    storeReportData(responseData.data[i].coordinates.lat, responseData.data[i].coordinates.long, responseData.data[i].severity, responseData.data[i].time, reportdataArray);
                
            }
        }

        function storeReportData(a, b, c, d, array) {
            array.push(a);
            array.push(b);
            array.push(c);
            array.push(d);
        }

        function Unix_datestamp(t) {
            var dt = new Date(t * 1000);
            var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            var year = dt.getFullYear();
            var month = months[dt.getMonth()];
            var date = dt.getDate();
            return date + "/" + month + "/" + year;
        }


        //function which filter out the Severity

        function findSeverityValue(x, y) {
            var highest;
            if (Math.abs(x) > Math.abs(y))
                highest = Math.abs(x);
            else
                highest = Math.abs(y);

            return highest;


        }



        //function to assign the severity for pothhole

        function assignSeverity(highest) {
            var severityValue;
            //alert(highest);
            //if (highest >= 1.3) { severityValue = 3; }
            //if (highest =< 1.29 && highest < 1.15) { severityValue = 2; }
            //if (highest =< 1.14 && highest < 1) { severityValue = 1; }

            if (highest > 1 && highest < 1.3) {
                severityValue = 1;
            }
            else if (highest > 1.14 && highest < 1.3) {
                severityValue = 2;
            }
            else {
                severityValue = 3;
            }
            return severityValue;

        }


        //this function will generate the table

        function myFunction() {

            String.prototype.isNumber = function () { return /^\d+$/.test(this); }
            var latestColumn = 0;
            var counter = 0;

            // get the reference for the body
            var body = document.getElementsByTagName("div")[4];

            var div = document.createElement("div");
            // creates a <table> element and a <tbody> element
            var tbl = document.createElement("table");
            var tblBody = document.createElement("tbody");

            // creating all cells
            for (var i = 0; i <= reportDataLengthCounter; i++) {
                // creates a table row
                var row = document.createElement("tr");
                for (var j = 0; j <= 3; j++) {
                    // Create a <td> element and a text node, make the text
                    // node the contents of the <td>, and put the <td> at
                    // the end of the table row
                    if (i == 0) { var cell = document.createElement("th"); }
                    else { var cell = document.createElement("td"); }
                    var cellText = document.createTextNode(reportdataArray[counter]);
                    cell.appendChild(cellText);
                    row.appendChild(cell);
                    
                    console.log(reportdataArray[counter]);

                    //if(reportdataArray[counter].isNumber)
                    //{
                    //cell.setAttribute("align", "center");

                    if (reportdataArray[counter] == 'Since') {
                        
                        cell.setAttribute("width", "200px");
                        cell.style.textAlign = "center";
                        }
                    else
                        {
                        cell.setAttribute("width", "150px");
                        cell.style.textAlign = "center";
                        }
                    if (reportdataArray[counter] == 'Latitude' || reportdataArray[counter] == 'Longitude' || reportdataArray[counter] == 'Severity' || reportdataArray[counter] == 'Since')
                    {
                        cell.style.background = "rgb(91,177,235)";
                    }
                    else if (reportdataArray[counter] == 3) {
                        cell.style.background = "rgb(255,0,0)";
                        cell.style.textAlign = "center";
                        console.log("severity3");
                    }
                    else if (reportdataArray[counter] == 2) {
                        cell.style.background = "rgb(255,191,0)";
                        cell.style.textAlign = "center";
                        console.log("severity2");

                    }
                    else {
                        console.log("severity1");
                        cell.style.textAlign = "center";

                    }
                    counter++;





                }
                tblBody.appendChild(row);
            }

            // add the row to the end of the table body
                        
            // put the <tbody> in the <table>
            tbl.appendChild(tblBody);
            // appends <table> into <body>
            //body.appendChild(tbl);
            div.appendChild(tbl);
            body.appendChild(div);
            // sets the border attribute of tbl to 2;
            tbl.setAttribute("border", "1");
            tbl.setAttribute("cellPadding", "3");
            tbl.setAttribute("cellSpacing", "3");
            tbl.setAttribute("align", "center");

            //div.setAttribute("height", "100px");
            //div.setAttribute("overflow", "auto");



        }


        //$.getJSON("http://localhost:84/data.json", checkCriteriaData);
		
		$(document).ready(function () {
            $.ajax({
                url: 'https://por-service.herokuapp.com/api/fetch?severity=1,2,3',
		  
          type: 'GET',
          dataType: 'json',
          success:checkCriteriaData,
	
	
		error: function()
		  {
		  alert('Please try again later!');
		  },
          beforeSend: function setHeader(xhr) {
        xhr.setRequestHeader('x-access-token', 'f3c6559f-8bbc-443b-8535-f81cbff76e9a');
        xhr.setRequestHeader('Content-Type', 'application/json');
      }
	  
	  });
	  });

    </script>

</body>
</html>